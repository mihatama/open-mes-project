{% extends "inventory/base.html" %}
{% load md5url %}
{% block inventory_content %}
<div class="inventory-inquiry">
    <h2>在庫照会</h2>
    <table>
        <thead>
            <tr>
                <th>製品/材料名</th>
                <th>倉庫</th>
                <th>在庫数</th>
                <th>引当在庫</th>
                <th>利用可能数</th>
                <th>場所</th>
                <th>最終更新日時</th>
            </tr>
        </thead>
        <tbody>
            <!-- 在庫情報はJavaScriptによってここに挿入されます -->
        </tbody>
    </table>
</div>

<style>
    .inventory-inquiry {
        width: 100%;
    }

    .inventory-inquiry table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 20px;
    }

    .inventory-inquiry th,
    .inventory-inquiry td {
        border: 1px solid #ddd;
        padding: 8px;
        text-align: left;
    }

    .inventory-inquiry th {
        background-color: #f0f0f0;
    }

    .inventory-inquiry tbody tr:nth-child(even) {
        background-color: #f9f9f9;
    }
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const tbody = document.querySelector('.inventory-inquiry table tbody');
    // rest_views.pyで定義された実際のAPIエンドポイントURLに置き換えてください
    // 例: const apiUrl = '/api/v1/inventory/';
    // この例では、仮のURL '/api/inventory/' を使用します。
    const apiUrl = '/inventory/data/'; 

    fetch(apiUrl)
        .then(response => {
            if (!response.ok) {
                throw new Error('Network response was not ok: ' + response.statusText);
            }
            return response.json();
        })
        .then(apiResponse => {
            tbody.innerHTML = ''; // 既存の行をクリア

            // APIがページネーションされたレスポンスを返すため、実際のデータは 'results' プロパティにあります。
            const inventoryData = apiResponse.results;

            if (inventoryData && inventoryData.length > 0) {
                inventoryData.forEach(inventory => {
                    const row = tbody.insertRow();
                    row.insertCell().textContent = inventory.part_number || 'N/A'; // 'part_number' を使用
                    row.insertCell().textContent = inventory.warehouse || 'N/A';   // 'warehouse' を使用
                    row.insertCell().textContent = inventory.quantity;
                    row.insertCell().textContent = inventory.reserved;
                    row.insertCell().textContent = inventory.available_quantity;
                    row.insertCell().textContent = inventory.location;
                    row.insertCell().textContent = inventory.last_updated ? new Date(inventory.last_updated).toLocaleString() : 'N/A';
                });
            } else {
                const row = tbody.insertRow();
                const cell = row.insertCell();
                cell.colSpan = 7;
                cell.textContent = '在庫情報がありません。';
            }
        })
        .catch(error => {
            console.error('Error fetching inventory data:', error);
            tbody.innerHTML = ''; // エラー時もクリア
            const row = tbody.insertRow();
            const cell = row.insertCell();
            cell.colSpan = 7;
            cell.textContent = 'データの取得中にエラーが発生しました。';
        });
});
</script>

{% endblock inventory_content %}

{% block inventory_js_link %}
<script src="{% md5url 'js/top.js' %}"></script>
<link rel="stylesheet" href="{% md5url 'css/top.css' %}" />
{% endblock inventory_js_link %}
